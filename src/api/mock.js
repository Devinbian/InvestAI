import Mock from "mockjs";

// æ¨¡æ‹Ÿè‚¡ç¥¨æ•°æ®
const stockList = Mock.mock({
  "list|10": [
    {
      "code|600000-603999": 1,
      name: "@cword(2,4)",
      "price|10-100.2": 1,
      "change|0-10.2": 1,
      "changePercent|0-10.2": 1,
      industry:
        '@pick(["ç§‘æŠ€", "é‡‘è", "åŒ»ç–—å¥åº·", "æ¶ˆè´¹", "èƒ½æº", "æˆ¿åœ°äº§", "åˆ¶é€ ä¸š", "å†œä¸š"])',
      "pe|0-100.2": 1,
      "pb|0-10.2": 1,
      "marketCap|100000000-10000000000": 1,
    },
  ],
}).list;

// æ¨¡æ‹Ÿå¯¹è¯å†å²
const chatHistory = [
  {
    role: "assistant",
    content:
      "æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½æŠ•èµ„åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®æ‚¨åˆ†æè‚¡ç¥¨ã€æä¾›æŠ•èµ„å»ºè®®ï¼Œä»¥åŠå›ç­”æ‚¨çš„æŠ•èµ„ç›¸å…³é—®é¢˜ã€‚è¯·é—®æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ",
  },
];

// æ¨¡æ‹ŸAPIå“åº”
export const mockApi = {
  // è·å–è‚¡ç¥¨åˆ—è¡¨
  getStockList: () => {
    return Promise.resolve({
      code: 200,
      data: stockList,
      message: "success",
    });
  },

  // è·å–å¯¹è¯å†å²
  getChatHistory: () => {
    return Promise.resolve({
      code: 200,
      data: chatHistory,
      message: "success",
    });
  },

  // å‘é€æ¶ˆæ¯
  sendMessage: (message) => {
    // æ£€æŸ¥æ˜¯å¦æ˜¯è‚¡ç¥¨ç›¸å…³æŸ¥è¯¢
    const stockKeywords = [
      "è‚¡ç¥¨",
      "åˆ†æ",
      "å¹³å®‰é“¶è¡Œ",
      "äº”ç²®æ¶²",
      "ä¸‡ç§‘",
      "å®å¾·æ—¶ä»£",
      "èŒ…å°",
      "è…¾è®¯",
      "é˜¿é‡Œ",
      "æ¯”äºšè¿ª",
    ];
    const isStockQuery = stockKeywords.some((keyword) =>
      message.includes(keyword),
    );

    // æ£€æŸ¥æ˜¯å¦æ˜¯è´­ä¹°ç›¸å…³æŸ¥è¯¢
    const buyKeywords = ["è´­ä¹°", "ä¹°å…¥", "ä¹°", "ä¸‹å•"];
    const isBuyQuery = buyKeywords.some((keyword) => message.includes(keyword));

    // æ£€æŸ¥æ˜¯å¦æ˜¯é‡åŒ–ç›¸å…³æŸ¥è¯¢
    const quantKeywords = [
      "é‡åŒ–",
      "ç­–ç•¥",
      "å›æµ‹",
      "å› å­",
      "ç®—æ³•",
      "ä¿¡å·",
      "å¤šå› å­",
      "æŠ€æœ¯æŒ‡æ ‡",
    ];
    const isQuantQuery = quantKeywords.some((keyword) =>
      message.includes(keyword),
    );

    let response;

    if (isBuyQuery) {
      // è´­ä¹°ç›¸å…³å“åº”
      const stockInfo = {
        code: "000001",
        name: "å¹³å®‰é“¶è¡Œ",
        price: "12.45",
        change: 0.23,
        changePercent: 1.88,
        industry: "é“¶è¡Œ",
        pe: 5.2,
        pb: 0.8,
        marketCap: 240000000000,
      };

      response = {
        role: "assistant",
        content: `æˆ‘ä¸ºæ‚¨æ‰¾åˆ°äº†${stockInfo.name}(${stockInfo.code})çš„äº¤æ˜“ä¿¡æ¯ï¼š

**å½“å‰ä»·æ ¼**ï¼šÂ¥${stockInfo.price}
**ä»Šæ—¥æ¶¨è·Œ**ï¼š${stockInfo.change > 0 ? "+" : ""}${stockInfo.change}(${stockInfo.changePercent > 0 ? "+" : ""}${stockInfo.changePercent}%)

æ‚¨å¯ä»¥é€šè¿‡ä¸‹æ–¹çš„è´­ä¹°æŒ‰é’®è¿›è¡Œäº¤æ˜“æ“ä½œã€‚å»ºè®®æ‚¨ï¼š
â€¢ æ ¹æ®è‡ªå·±çš„é£é™©æ‰¿å—èƒ½åŠ›ç¡®å®šè´­ä¹°æ•°é‡
â€¢ æ³¨æ„åˆ†æ•£æŠ•èµ„ï¼Œä¸è¦æŠŠæ‰€æœ‰èµ„é‡‘æŠ•å…¥å•ä¸€è‚¡ç¥¨
â€¢ å…³æ³¨å¸‚åœºåŠ¨æ€ï¼Œé€‚æ—¶è°ƒæ•´æŠ•èµ„ç­–ç•¥`,
        stockInfo: stockInfo,
        hasStockInfo: true,
        isBuyMode: true, // æ ‡è¯†è¿™æ˜¯è´­ä¹°æ¨¡å¼
      };
    } else if (isQuantQuery) {
      // é‡åŒ–ç›¸å…³å“åº”
      const quantResponses = {
        strategy: `ğŸ¤– **é‡åŒ–ç­–ç•¥æ¨è**

åŸºäºå½“å‰å¸‚åœºç¯å¢ƒï¼Œæˆ‘ä¸ºæ‚¨æ¨èä»¥ä¸‹é€‚åˆæ•£æˆ·çš„é‡åŒ–ç­–ç•¥ï¼š

**1. å‡å€¼å›å½’ç­–ç•¥**
â€¢ é€‚ç”¨åœºæ™¯ï¼šéœ‡è¡å¸‚åœº
â€¢ é¢„æœŸå¹´åŒ–æ”¶ç›Šï¼š12-18%
â€¢ é£é™©ç­‰çº§ï¼šä¸­ç­‰
â€¢ ç­–ç•¥åŸç†ï¼šåˆ©ç”¨ä»·æ ¼åç¦»å‡å€¼åçš„å›å½’ç‰¹æ€§

**2. åŠ¨é‡ç­–ç•¥**
â€¢ é€‚ç”¨åœºæ™¯ï¼šè¶‹åŠ¿æ˜ç¡®çš„å¸‚åœº
â€¢ é¢„æœŸå¹´åŒ–æ”¶ç›Šï¼š15-25%
â€¢ é£é™©ç­‰çº§ï¼šè¾ƒé«˜
â€¢ ç­–ç•¥åŸç†ï¼šè¿½è¸ªå¼ºåŠ¿è‚¡ç¥¨çš„æŒç»­ä¸Šæ¶¨

**3. å¤šå› å­é€‰è‚¡æ¨¡å‹**
â€¢ é€‚ç”¨åœºæ™¯ï¼šé•¿æœŸæŠ•èµ„
â€¢ é¢„æœŸå¹´åŒ–æ”¶ç›Šï¼š10-20%
â€¢ é£é™©ç­‰çº§ï¼šä¸­ç­‰
â€¢ ç­–ç•¥åŸç†ï¼šç»¼åˆä¼°å€¼ã€ç›ˆåˆ©ã€æˆé•¿ç­‰å¤šä¸ªå› å­

ğŸ’¡ **å»ºè®®**ï¼šå¯ä»¥åœ¨ä¾§è¾¹æ çš„"é‡åŒ–åˆ†æ"ä¸­è¿›è¡Œè¯¦ç»†çš„ç­–ç•¥å›æµ‹å’Œå› å­åˆ†æã€‚`,

        factor: `ğŸ“Š **å¤šå› å­é€‰è‚¡åˆ†æ**

åŸºäºé‡åŒ–å› å­æ¨¡å‹ï¼Œæˆ‘ä¸ºæ‚¨åˆ†æäº†å½“å‰å¸‚åœºçš„æœ‰æ•ˆå› å­ï¼š

**ä¼°å€¼å› å­**
â€¢ PEå› å­ï¼šå½“å‰æœ‰æ•ˆæ€§è¾ƒé«˜ï¼ŒICå€¼0.08
â€¢ PBå› å­ï¼šåœ¨é“¶è¡Œã€åœ°äº§æ¿å—è¡¨ç°çªå‡º
â€¢ å»ºè®®æƒé‡ï¼š25%

**ç›ˆåˆ©å› å­**
â€¢ ROEå› å­ï¼šæŒç»­æœ‰æ•ˆï¼Œé€‚åˆé•¿æœŸæŒæœ‰
â€¢ å‡€åˆ©æ¶¦å¢é•¿ç‡ï¼šåœ¨æˆé•¿è‚¡ä¸­è¡¨ç°ä¼˜å¼‚
â€¢ å»ºè®®æƒé‡ï¼š30%

**æŠ€æœ¯å› å­**
â€¢ åŠ¨é‡å› å­ï¼šçŸ­æœŸæœ‰æ•ˆæ€§å¼ºï¼Œé€‚åˆæ³¢æ®µæ“ä½œ
â€¢ åè½¬å› å­ï¼šåœ¨è¶…è·Œè‚¡ä¸­è¡¨ç°è‰¯å¥½
â€¢ å»ºè®®æƒé‡ï¼š20%

**è´¨é‡å› å­**
â€¢ èµ„äº§è´Ÿå€ºç‡ï¼šåœ¨å½“å‰ç¯å¢ƒä¸‹é‡è¦æ€§æå‡
â€¢ ç°é‡‘æµå› å­ï¼šé˜²å¾¡æ€§è¾ƒå¼º
â€¢ å»ºè®®æƒé‡ï¼š25%

ğŸ¯ **é€‰è‚¡å»ºè®®**ï¼šå»ºè®®ä½¿ç”¨å¤šå› å­ç»¼åˆè¯„åˆ†ï¼Œé€‰æ‹©æ’åå‰20%çš„è‚¡ç¥¨æ„å»ºæŠ•èµ„ç»„åˆã€‚`,

        signal: `ğŸ“¡ **æŠ€æœ¯æŒ‡æ ‡äº¤æ˜“ä¿¡å·**

åŸºäºå¤šç§æŠ€æœ¯æŒ‡æ ‡ç»„åˆï¼Œå½“å‰å¸‚åœºä¿¡å·å¦‚ä¸‹ï¼š

**ä¹°å…¥ä¿¡å·**
â€¢ å¹³å®‰é“¶è¡Œ(000001)ï¼šMACDé‡‘å‰ + RSIè¶…å–åå¼¹
â€¢ æ‹›å•†é“¶è¡Œ(600036)ï¼šå‡çº¿å¤šå¤´æ’åˆ— + æˆäº¤é‡æ”¾å¤§
â€¢ äº”ç²®æ¶²(000858)ï¼šå¸ƒæ—å¸¦ä¸‹è½¨åå¼¹ + KDJé‡‘å‰

**å–å‡ºä¿¡å·**
â€¢ æŸç§‘æŠ€è‚¡ï¼šRSIè¶…ä¹° + é¡¶èƒŒç¦»
â€¢ æŸåœ°äº§è‚¡ï¼šè·Œç ´é‡è¦æ”¯æ’‘ä½

**è§‚æœ›ä¿¡å·**
â€¢ å¤§ç›˜æŒ‡æ•°ï¼šåœ¨å…³é”®é˜»åŠ›ä½é™„è¿‘éœ‡è¡
â€¢ å»ºè®®ç­‰å¾…æ˜ç¡®çªç ´ä¿¡å·

âš ï¸ **é£é™©æç¤º**ï¼šæŠ€æœ¯æŒ‡æ ‡å…·æœ‰æ»åæ€§ï¼Œå»ºè®®ç»“åˆåŸºæœ¬é¢åˆ†æä½¿ç”¨ã€‚ä¿¡å·ä»…ä¾›å‚è€ƒï¼ŒæŠ•èµ„éœ€è°¨æ…ã€‚`,

        backtest: `ğŸ“ˆ **ç­–ç•¥å›æµ‹ç»“æœ**

æˆ‘ä¸ºæ‚¨æ¨¡æ‹Ÿäº†ä¸€ä¸ªå¤šå› å­ç­–ç•¥çš„å†å²å›æµ‹ï¼š

**å›æµ‹å‚æ•°**
â€¢ å›æµ‹æœŸé—´ï¼š2020-01-01 è‡³ 2024-01-01
â€¢ åˆå§‹èµ„é‡‘ï¼š100ä¸‡å…ƒ
â€¢ è‚¡ç¥¨æ± ï¼šæ²ªæ·±300
â€¢ è°ƒä»“é¢‘ç‡ï¼šæœˆåº¦

**å›æµ‹ç»“æœ**
â€¢ æ€»æ”¶ç›Šç‡ï¼š+68.5%
â€¢ å¹´åŒ–æ”¶ç›Šç‡ï¼š+14.2%
â€¢ æœ€å¤§å›æ’¤ï¼š-12.8%
â€¢ å¤æ™®æ¯”ç‡ï¼š1.35
â€¢ èƒœç‡ï¼š58.3%
â€¢ äº¤æ˜“æ¬¡æ•°ï¼š156æ¬¡

**åŸºå‡†å¯¹æ¯”**
â€¢ æ²ªæ·±300æŒ‡æ•°åŒæœŸæ”¶ç›Šï¼š+28.3%
â€¢ è¶…é¢æ”¶ç›Šï¼š+40.2%
â€¢ ä¿¡æ¯æ¯”ç‡ï¼š1.12

âœ… **ç­–ç•¥è¯„ä»·**ï¼šè¯¥ç­–ç•¥åœ¨å†å²æ•°æ®ä¸­è¡¨ç°è‰¯å¥½ï¼Œå…·æœ‰è¾ƒå¥½çš„é£é™©è°ƒæ•´æ”¶ç›Šã€‚ä½†è¯·æ³¨æ„ï¼Œå†å²è¡¨ç°ä¸ä»£è¡¨æœªæ¥æ”¶ç›Šã€‚`,
      };

      // æ ¹æ®æ¶ˆæ¯å†…å®¹é€‰æ‹©åˆé€‚çš„å“åº”
      let quantContent;
      if (message.includes("ç­–ç•¥")) {
        quantContent = quantResponses.strategy;
      } else if (message.includes("å› å­")) {
        quantContent = quantResponses.factor;
      } else if (message.includes("ä¿¡å·") || message.includes("æŠ€æœ¯æŒ‡æ ‡")) {
        quantContent = quantResponses.signal;
      } else if (message.includes("å›æµ‹")) {
        quantContent = quantResponses.backtest;
      } else {
        quantContent = quantResponses.strategy; // é»˜è®¤è¿”å›ç­–ç•¥ä»‹ç»
      }

      response = {
        role: "assistant",
        content: quantContent,
        hasStockInfo: false,
        isQuantAnalysis: true, // æ ‡è¯†è¿™æ˜¯é‡åŒ–åˆ†æ
      };
    } else if (isStockQuery) {
      // æ¨¡æ‹Ÿè‚¡ç¥¨åˆ†æå“åº”ï¼ŒåŒ…å«ç»“æ„åŒ–è‚¡ç¥¨ä¿¡æ¯
      const stockInfo = {
        code: "000001",
        name: "å¹³å®‰é“¶è¡Œ",
        price: "12.45",
        change: 0.23,
        changePercent: 1.88,
        industry: "é“¶è¡Œ",
        pe: 5.2,
        pb: 0.8,
        marketCap: 240000000000,
        analysis: {
          fundamental: "å…¬å¸åŸºæœ¬é¢è‰¯å¥½ï¼ŒROEæŒç»­æå‡ï¼Œèµ„äº§è´¨é‡ç¨³å®šã€‚",
          technical: "æŠ€æœ¯é¢æ˜¾ç¤ºè‚¡ä»·å¤„äºä¸Šå‡é€šé“ï¼ŒMACDé‡‘å‰ï¼ŒRSIæŒ‡æ ‡å¥åº·ã€‚",
          recommendation: "å»ºè®®é€‚é‡é…ç½®ï¼Œç›®æ ‡ä»·ä½13.5å…ƒã€‚",
          risk: "éœ€å…³æ³¨é“¶è¡Œä¸šç›‘ç®¡æ”¿ç­–å˜åŒ–å’Œåˆ©ç‡ç¯å¢ƒå½±å“ã€‚",
        },
      };

      response = {
        role: "assistant",
        content: `æ ¹æ®æ‚¨çš„æŸ¥è¯¢ï¼Œæˆ‘ä¸ºæ‚¨åˆ†æäº†${stockInfo.name}(${stockInfo.code})ï¼š

**åŸºæœ¬ä¿¡æ¯**
â€¢ å½“å‰ä»·æ ¼ï¼šÂ¥${stockInfo.price}
â€¢ æ¶¨è·Œå¹…ï¼š${stockInfo.change > 0 ? "+" : ""}${stockInfo.change}(${stockInfo.changePercent > 0 ? "+" : ""}${stockInfo.changePercent}%)
â€¢ æ‰€å±è¡Œä¸šï¼š${stockInfo.industry}
â€¢ å¸‚ç›ˆç‡ï¼š${stockInfo.pe}
â€¢ å¸‚å‡€ç‡ï¼š${stockInfo.pb}

**æŠ•èµ„åˆ†æ**
ğŸ“Š **åŸºæœ¬é¢åˆ†æ**ï¼š${stockInfo.analysis.fundamental}

ğŸ“ˆ **æŠ€æœ¯é¢åˆ†æ**ï¼š${stockInfo.analysis.technical}

ğŸ’¡ **æŠ•èµ„å»ºè®®**ï¼š${stockInfo.analysis.recommendation}

âš ï¸ **é£é™©æç¤º**ï¼š${stockInfo.analysis.risk}`,
        stockInfo: stockInfo, // é™„åŠ è‚¡ç¥¨ä¿¡æ¯ç”¨äºè‡ªé€‰è‚¡åŠŸèƒ½
        hasStockInfo: true,
      };
    } else {
      // æ™®é€šAIå“åº”
      const responses = [
        "æ ¹æ®æ‚¨çš„é£é™©åå¥½å’ŒæŠ•èµ„ç›®æ ‡ï¼Œæˆ‘å»ºè®®æ‚¨å¯ä»¥å…³æ³¨ä»¥ä¸‹è‚¡ç¥¨ã€‚",
        "ä»æŠ€æœ¯é¢åˆ†æï¼Œè¯¥è‚¡ç¥¨ç›®å‰å¤„äºä¸Šå‡è¶‹åŠ¿ï¼Œä½†éœ€è¦æ³¨æ„é£é™©æ§åˆ¶ã€‚",
        "æ ¹æ®åŸºæœ¬é¢åˆ†æï¼Œè¯¥å…¬å¸çš„è´¢åŠ¡çŠ¶å†µè‰¯å¥½ï¼Œå…·æœ‰é•¿æœŸæŠ•èµ„ä»·å€¼ã€‚",
        "å»ºè®®æ‚¨å…³æ³¨è¯¥è¡Œä¸šçš„é¾™å¤´ä¼ä¸šï¼Œå®ƒä»¬é€šå¸¸å…·æœ‰æ›´å¥½çš„æŠ—é£é™©èƒ½åŠ›ã€‚",
        "ä»ä¼°å€¼è§’åº¦æ¥çœ‹ï¼Œç›®å‰è¯¥è‚¡ç¥¨çš„PEå¤„äºå†å²ä½ä½ï¼Œå…·æœ‰æŠ•èµ„ä»·å€¼ã€‚",
      ];

      response = {
        role: "assistant",
        content: responses[Math.floor(Math.random() * responses.length)],
        hasStockInfo: false,
      };
    }

    chatHistory.push({ role: "user", content: message }, response);

    return Promise.resolve({
      code: 200,
      data: response,
      message: "success",
    });
  },
};
