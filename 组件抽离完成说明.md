# 登录和找回密码功能组件化完成

## 概述

已成功将主页（Main.vue）中的登录和找回密码功能抽离成独立的组件，提高了代码的可维护性和复用性。

## 新创建的组件

### 1. LoginDialog.vue

**位置**: `src/components/LoginDialog.vue`

**功能**:

- 用户登录
- 用户注册
- 微信登录
- 登录/注册模式切换
- 表单验证
- 跳转到找回密码

**Props**:

- `modelValue`: Boolean - 控制对话框显示/隐藏
- `registerMode`: Boolean - 是否为注册模式

**Events**:

- `update:modelValue`: 更新对话框显示状态
- `login-success`: 登录成功事件，传递用户信息
- `show-recovery`: 显示找回密码对话框

### 2. PasswordRecoveryDialog.vue

**位置**: `src/components/PasswordRecoveryDialog.vue`

**功能**:

- 三步密码找回流程
  1. 输入手机号/邮箱
  2. 验证码验证
  3. 设置新密码
- 验证码倒计时
- 表单验证
- 返回登录功能

**Props**:

- `modelValue`: Boolean - 控制对话框显示/隐藏

**Events**:

- `update:modelValue`: 更新对话框显示状态
- `back-to-login`: 返回登录对话框
- `recovery-success`: 找回密码成功

## 主要修改

### Main.vue 的变化

**删除的内容**:

- 登录对话框的完整模板代码
- 找回密码对话框的完整模板代码
- 相关的响应式数据定义（loginForm, loginRules, recoveryForm, recoveryRules等）
- 相关的方法（handleLogin, handleWechatLogin, toggleAuthMode等）

**保留的内容**:

- 基本的状态控制变量（loginDialogVisible, recoveryDialogVisible, isRegisterMode）
- 组件间的事件处理方法

**新增的内容**:

- 组件导入语句
- 新的事件处理方法（handleLoginSuccess, showPasswordRecovery等）

### 事件流程

1. **显示登录对话框**:

   ```javascript
   showLogin(false); // 登录模式
   showLogin(true); // 注册模式
   ```

2. **登录成功处理**:

   ```javascript
   handleLoginSuccess({ isNewUser, userInfo });
   ```

3. **显示找回密码**:

   ```javascript
   showPasswordRecovery();
   ```

4. **找回密码完成**:
   ```javascript
   handleRecoverySuccess();
   ```

## 使用方式

### 在其他组件中使用

```vue
<template>
  <!-- 登录对话框 -->
  <LoginDialog
    v-model="loginVisible"
    :register-mode="isRegister"
    @login-success="onLoginSuccess"
    @show-recovery="showRecovery"
  />

  <!-- 找回密码对话框 -->
  <PasswordRecoveryDialog
    v-model="recoveryVisible"
    @back-to-login="backToLogin"
    @recovery-success="onRecoverySuccess"
  />
</template>

<script setup>
import LoginDialog from "@/components/LoginDialog.vue";
import PasswordRecoveryDialog from "@/components/PasswordRecoveryDialog.vue";

const loginVisible = ref(false);
const recoveryVisible = ref(false);
const isRegister = ref(false);

const onLoginSuccess = ({ isNewUser, userInfo }) => {
  // 处理登录成功逻辑
};

const showRecovery = () => {
  recoveryVisible.value = true;
};

const backToLogin = () => {
  loginVisible.value = true;
};

const onRecoverySuccess = () => {
  loginVisible.value = true;
};
</script>
```

## 优势

1. **代码复用**: 登录和找回密码功能可以在其他页面复用
2. **职责分离**: 每个组件专注于自己的功能
3. **维护性**: 降低了Main.vue的复杂度，便于维护
4. **测试友好**: 独立组件更容易进行单元测试
5. **性能优化**: 可以实现按需加载

## 注意事项

1. 组件内部管理自己的状态和表单验证
2. 通过事件与父组件通信，保持松耦合
3. 保持了原有的UI设计和用户体验
4. 微信登录功能已模拟实现，实际使用时需要接入真实API

## 测试建议

1. 测试登录功能是否正常
2. 测试注册功能是否正常
3. 测试找回密码流程是否完整
4. 测试组件间的事件传递是否正确
5. 测试表单验证是否有效
