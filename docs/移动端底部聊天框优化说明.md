# ç§»åŠ¨ç«¯åº•éƒ¨èŠå¤©æ¡†ä¼˜åŒ–è¯´æ˜

## é—®é¢˜æè¿°

åœ¨ç§»åŠ¨ç«¯æµè§ˆå™¨ä¸­ï¼Œåº•éƒ¨è¾“å…¥æ¡†ï¼ˆåŒ…æ‹¬èŠå¤©æ¨¡å¼çš„è¾“å…¥åŒºåŸŸå’Œä¸»ç•Œé¢çš„AIè¾“å…¥å¡ç‰‡ï¼‰ç»å¸¸è¢«æµè§ˆå™¨çš„åº•éƒ¨å·¥å…·æ é®æŒ¡ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

## è§£å†³æ–¹æ¡ˆ

### 1. æ™ºèƒ½æµè§ˆå™¨æ£€æµ‹

- **iOS Safari**: åº•éƒ¨å·¥å…·æ æœ€å°80pxï¼Œæœ€å¤§140pxåç§»
- **iOS Chrome**: åº•éƒ¨å·¥å…·æ æœ€å°90pxï¼Œæœ€å¤§150pxåç§»
- **Android Chrome**: åº•éƒ¨å·¥å…·æ 60-90pxåç§»
- **å¾®ä¿¡æµè§ˆå™¨**: ä½¿ç”¨è¾ƒå°åç§»é‡ï¼ˆåŸºç¡€åç§»çš„70%ï¼‰

### 2. åŒæ¨¡å¼é€‚é…

#### èŠå¤©æ¨¡å¼

- è°ƒæ•´ `.input-area` çš„ `bottom` ä½ç½®
- ä½¿ç”¨ `position: fixed` ç¡®ä¿è¾“å…¥æ¡†å§‹ç»ˆå¯è§
- æ·»åŠ ç¡¬ä»¶åŠ é€Ÿä¼˜åŒ–æ€§èƒ½

#### ä¸»ç•Œé¢æ¨¡å¼

- è°ƒæ•´ `.ai-card` çš„ `padding-bottom` é—´è·
- ç¡®ä¿AIè¾“å…¥å¡ç‰‡ä¸è¢«åº•éƒ¨å·¥å…·æ é®æŒ¡
- ä¿æŒå¡ç‰‡çš„å“åº”å¼å¸ƒå±€

### 3. åŠ¨æ€æ£€æµ‹æœºåˆ¶

- **visualViewport API**: å®æ—¶æ£€æµ‹å¯è§†åŒºåŸŸå˜åŒ–
- **å±å¹•é«˜åº¦å¯¹æ¯”**: è®¡ç®—æµè§ˆå™¨å·¥å…·æ å ç”¨ç©ºé—´
- **iOSå®‰å…¨åŒºåŸŸ**: æ£€æµ‹åº•éƒ¨å®‰å…¨åŒºåŸŸå’Œå·¥å…·æ çŠ¶æ€

### 4. å¤šé‡äº‹ä»¶ç›‘å¬

- `visualViewport` å˜åŒ–ç›‘å¬
- çª—å£å°ºå¯¸å˜åŒ–ç›‘å¬
- å±å¹•æ–¹å‘å˜åŒ–ç›‘å¬
- ç„¦ç‚¹å˜åŒ–ç›‘å¬ï¼ˆè™šæ‹Ÿé”®ç›˜ï¼‰
- é¡µé¢å¯è§æ€§å˜åŒ–ç›‘å¬
- é¡µé¢èšç„¦ç›‘å¬

### 5. é˜²æŠ–ä¼˜åŒ–

ä½¿ç”¨é˜²æŠ–å‡½æ•°é¿å…é¢‘ç¹é‡è®¡ç®—ï¼Œæå‡æ€§èƒ½ï¼š

```javascript
const handleViewportChange = debounce(() => {
  if (isMobileView.value) {
    fixMobileChatBox();
  }
}, 150);
```

## æ ¸å¿ƒä»£ç é€»è¾‘

### æµè§ˆå™¨æ£€æµ‹

```javascript
const isIOS = /iphone|ipad|ipod/.test(userAgent);
const isAndroid = /android/.test(userAgent);
const isSafari = /safari/.test(userAgent) && !/chrome/.test(userAgent);
const isChrome = /chrome/.test(userAgent);
```

### åç§»é‡è®¡ç®—

```javascript
if (isIOS) {
  if (isSafari) {
    baseOffset = hasBottomBar
      ? Math.max(toolbarHeight + 40, 120)
      : Math.max(baseOffset, 80);
  } else if (isChrome) {
    baseOffset = hasBottomBar
      ? Math.max(toolbarHeight + 50, 130)
      : Math.max(baseOffset, 90);
  }
}
```

### æ ·å¼åº”ç”¨

#### èŠå¤©æ¨¡å¼

```javascript
if (inputArea && isChatMode.value) {
  inputArea.style.cssText += `
        bottom: ${finalOffset}px !important;
        position: fixed !important;
        width: 100% !important;
    `;
}
```

#### ä¸»ç•Œé¢æ¨¡å¼

```javascript
if (aiCard && !isChatMode.value) {
  aiCard.style.cssText += `
        padding-bottom: ${finalOffset}px !important;
        box-sizing: border-box !important;
    `;
}
```

## CSSå±‚é¢è¾…åŠ©

```css
/* iOSè®¾å¤‡ç‰¹æ®Šå¤„ç† */
@supports (-webkit-touch-callout: none) {
  .ai-card {
    padding-bottom: calc(80px + env(safe-area-inset-bottom, 0px)) !important;
  }
}

/* ä½¿ç”¨ç°ä»£CSSç¯å¢ƒå˜é‡ */
.ai-card {
  padding-bottom: calc(
    env(keyboard-inset-height, 0px) + env(safe-area-inset-bottom, 0px) + 20px
  ) !important;
}
```

## è°ƒè¯•å·¥å…·

æä¾›ç§»åŠ¨ç«¯è°ƒè¯•é¢æ¿ï¼ˆğŸ›æŒ‰é’®ï¼‰ï¼Œæ˜¾ç¤ºï¼š

- æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬
- å±å¹•å°ºå¯¸ä¿¡æ¯
- å·¥å…·æ é«˜åº¦æ£€æµ‹
- å®é™…åº”ç”¨çš„åç§»é‡
- å¼ºåˆ¶ä¿®å¤åŠŸèƒ½

## å…¼å®¹æ€§

- âœ… iOS Safari 14+
- âœ… iOS Chrome 90+
- âœ… Android Chrome 80+
- âœ… å¾®ä¿¡å†…ç½®æµè§ˆå™¨
- âœ… å…¶ä»–ç°ä»£ç§»åŠ¨æµè§ˆå™¨

## æ€§èƒ½ä¼˜åŒ–

- é˜²æŠ–å‡½æ•°å‡å°‘é¢‘ç¹è®¡ç®—
- ç¡¬ä»¶åŠ é€Ÿä¼˜åŒ–æ¸²æŸ“
- æ¡ä»¶æ‰§è¡Œé¿å…ä¸å¿…è¦æ“ä½œ
- å»¶è¿Ÿæ‰§è¡Œç¡®ä¿DOMå®Œå…¨æ¸²æŸ“

## æµ‹è¯•å»ºè®®

1. åœ¨ä¸åŒiOSè®¾å¤‡ä¸Šæµ‹è¯•Safariå’ŒChrome
2. åœ¨ä¸åŒAndroidè®¾å¤‡ä¸Šæµ‹è¯•Chrome
3. åœ¨å¾®ä¿¡ä¸­æµ‹è¯•å†…ç½®æµè§ˆå™¨
4. æµ‹è¯•æ¨ªç«–å±åˆ‡æ¢åœºæ™¯
5. æµ‹è¯•è™šæ‹Ÿé”®ç›˜å¼¹å‡ºåœºæ™¯
6. ä½¿ç”¨è°ƒè¯•é¢æ¿æŸ¥çœ‹å®é™…æ•°å€¼
